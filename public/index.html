<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="./component/global/style.css" />
    <link rel="stylesheet" href="./component/NavBar/style.css" />
    <link rel="stylesheet" href="./component/Header/style.css" />
    <link rel="stylesheet" href="./component/Catalago/style.css" />
    <script
      type="text/javascript"
      src="https://www.chartjs.org/dist/2.8.0/Chart.min.js"
    ></script>

    <title>Devs Community</title>
  </head>
  <body>
    <div id="NavBar">
      <div>
        <h1>Devs Community</h1>
      </div>
      <div id="user_login">
        <h1 id="nome_user">Olá, ReeD</h1>
      </div>
      <div id="btn-1">
        <a href="./pages/sobre/index.html">Sobre</a>
        <a id="login" href="./pages/login/index.html">Logar-se</a>
      </div>
      <div id="btn-2">
        <a href="./pages/sobre/index.html">Sobre</a>
        <a id="sair" onclick="sair()">Sair</a>
      </div>
    </div>
    <div id="Header"></div>
    <div>
      <div class="divsoria"></div>
      <h1 class="title2 color-white">Referências pela comunidade</h1>
      <div class="center">
        <div class="grafico">
          <canvas id="graficoDados1"></canvas>
        </div>
        <div class="grafico">
          <canvas id="graficoDados2"></canvas>
        </div>
      </div>
      <h1 class="title2 color-white">Linguagens | Bibliotecas</h1>
      <div id="catalago"></div>
    </div>
    <div class="center"></div>
  </body>
</html>

<script src="./script.js"></script>
<script src="./component/global/index.js"></script>
<script src="./component/Catalago/index.js"></script>

<script>
  window.onload = totalLikes();
  window.onload = totalViews();

  function totalViews() {
    fetch("/view/listar/todos").then((response) => {
      response.json().then((data) => {
        const dados = data.response;
        plotarGrafico2(dados);
      });
    });
  }

  function totalLikes() {
    fetch("/like/total").then((response) => {
      response.json().then((data) => {
        const dados = data.response;
        plotarGrafico(dados);
      });
    });
  }

  function plotarGrafico(response) {
    var dados = {
      labels: ["Total de Likes"],

      datasets: [
        {
          yAxisID: "y-like",
          label: "ReactJs",
          borderColor: "#32b9cd",
          backgroundColor: "#32b9cd",
          fill: false,
          data: [],
        },
        {
          yAxisID: "y-like2",
          label: "NodeJs",
          borderColor: "#52b788",
          backgroundColor: "#52b788",
          fill: false,
          data: [],
        },
        {
          yAxisID: "y-like3",
          label: "PHP7",
          borderColor: "#6C7EB7",
          backgroundColor: "#6C7EB7",
          fill: false,
          data: [],
        },
        {
          yAxisID: "y-like4",
          label: "JAVA",
          borderColor: "#F29111",
          backgroundColor: "#F29111",
          fill: false,
          data: [],
        },
        {
          yAxisID: "y-like5",
          label: "PYTHON",
          borderColor: "#2B7EB2",
          backgroundColor: "#2B7EB2",
          fill: false,
          data: [],
        },
        {
          yAxisID: "y-like6",
          label: "FLUTTER",
          borderColor: "#03569B",
          backgroundColor: "#03569B",
          fill: false,
          data: [],
        },
        {
          yAxisID: "y-like7",
          label: "DART",
          borderColor: "#00D3B8",
          backgroundColor: "#00D3B8",
          fill: false,
          data: [],
        },
      ],
    };

    for (let i = 0; i < response.length; i++) {
      switch (response[i].nome) {
        case "React": {
          dados.datasets[0].data.push(response[i].qtd_like);
          break;
        }
        case "NodeJs": {
          dados.datasets[1].data.push(response[i].qtd_like);
          break;
        }
        case "PHP7": {
          dados.datasets[2].data.push(response[i].qtd_like);
          break;
        }
        case "Java": {
          dados.datasets[3].data.push(response[i].qtd_like);
          break;
        }
        case "Python": {
          dados.datasets[4].data.push(response[i].qtd_like);
          break;
        }
        case "Flutter": {
          dados.datasets[4].data.push(response[i].qtd_like);
          break;
        }
        case "Dart": {
          dados.datasets[4].data.push(response[i].qtd_like);
          break;
        }
      }
    }

    var ctx = graficoDados1.getContext("2d");
    window.grafico_linha = Chart.Bar(ctx, {
      data: dados,
      options: {
        responsive: true,
        animation: { duration: 500 },
        hoverMode: "index",
        stacked: false,
        title: {
          display: true,
          text: "Total de Likes",
        },
        scales: {
          yAxes: [
            {
              type: "linear",
              display: true,
              position: "left",
              id: "y-like",
              ticks: {
                beginAtZero: true,
                max: 100,
                min: 0,
              },
            },
            {
              type: "linear",
              display: false,
              position: "right",
              id: "y-like2",
              ticks: {
                beginAtZero: true,
                max: 100,
                min: 0,
              },

              gridLines: {
                drawOnChartArea: true,
              },
            },
            {
              type: "linear",
              display: false,
              position: "right",
              id: "y-like3",
              ticks: {
                beginAtZero: true,
                max: 100,
                min: 0,
              },

              gridLines: {
                drawOnChartArea: true,
              },
            },
            {
              type: "linear",
              display: false,
              position: "right",
              id: "y-like4",
              ticks: {
                beginAtZero: true,
                max: 100,
                min: 0,
              },

              gridLines: {
                drawOnChartArea: true,
              },
            },
            {
              type: "linear",
              display: false,
              position: "right",
              id: "y-like5",
              ticks: {
                beginAtZero: true,
                max: 100,
                min: 0,
              },

              gridLines: {
                drawOnChartArea: true,
              },
            },
            {
              type: "linear",
              display: false,
              position: "right",
              id: "y-like6",
              ticks: {
                beginAtZero: true,
                max: 100,
                min: 0,
              },

              gridLines: {
                drawOnChartArea: true,
              },
            },
            {
              type: "linear",
              display: false,
              position: "right",
              id: "y-like7",
              ticks: {
                beginAtZero: true,
                max: 100,
                min: 0,
              },

              gridLines: {
                drawOnChartArea: true,
              },
            },
          ],
        },
      },
    });
  }

  function plotarGrafico2(response) {
    var dados = {
      labels: ["Acessos"],
      datasets: [
        {
          yAxisID: "y-like",
          label: "ReactJs",
          borderColor: "#32b9cd",
          backgroundColor: "#32b9cd",
          fill: false,
          data: [],
        },
        {
          yAxisID: "y-like2",
          label: "NodeJs",
          borderColor: "#52b788",
          backgroundColor: "#52b788",
          fill: false,
          data: [],
        },
        {
          yAxisID: "y-like3",
          label: "PHP7",
          borderColor: "#6C7EB7",
          backgroundColor: "#6C7EB7",
          fill: false,
          data: [],
        },
        {
          yAxisID: "y-like4",
          label: "JAVA",
          borderColor: "#F29111",
          backgroundColor: "#F29111",
          fill: false,
          data: [],
        },
        {
          yAxisID: "y-like5",
          label: "PYTHON",
          borderColor: "#2B7EB2",
          backgroundColor: "#2B7EB2",
          fill: false,
          data: [],
        },
        {
          yAxisID: "y-like6",
          label: "FLUTTER",
          borderColor: "#03569B",
          backgroundColor: "#03569B",
          fill: false,
          data: [],
        },
        {
          yAxisID: "y-like7",
          label: "DART",
          borderColor: "#00D3B8",
          backgroundColor: "#00D3B8",
          fill: false,
          data: [],
        },
      ],
    };

    dados.datasets[0].data.push(
      response[0].qtd_acessos > 0 ? response[0].qtd_acessos : 0
    );
    dados.datasets[1].data.push(
      response[1].qtd_acessos > 0 ? response[1].qtd_acessos : 0
    );
    dados.datasets[2].data.push(
      response[2].qtd_acessos > 0 ? response[2].qtd_acessos : 0
    );
    dados.datasets[3].data.push(
      response[3].qtd_acessos > 0 ? response[3].qtd_acessos : 0
    );
    dados.datasets[4].data.push(
      response[4].qtd_acessos > 0 ? response[4].qtd_acessos : 0
    );
    dados.datasets[5].data.push(
      response[5].qtd_acessos > 0 ? response[5].qtd_acessos : 0
    );
    dados.datasets[6].data.push(
      response[6].qtd_acessos > 0 ? response[6].qtd_acessos : 0
    );

    var ctx = graficoDados2.getContext("2d");
    window.grafico_linha = Chart.Bar(ctx, {
      data: dados,
      options: {
        responsive: true,
        animation: { duration: 500 },
        hoverMode: "index",
        stacked: false,
        title: {
          display: true,
          text: "Total de Acessos",
        },
        scales: {
          yAxes: [
            {
              type: "linear",
              display: true,
              position: "left",
              id: "y-like",
              ticks: {
                beginAtZero: true,
                max: 500,
                min: 0,
              },
            },
            {
              type: "linear",
              display: false,
              position: "right",
              id: "y-like2",
              ticks: {
                beginAtZero: true,
                max: 500,
                min: 0,
              },

              gridLines: {
                drawOnChartArea: true,
              },
            },
            {
              type: "linear",
              display: false,
              position: "right",
              id: "y-like3",
              ticks: {
                beginAtZero: true,
                max: 500,
                min: 0,
              },

              gridLines: {
                drawOnChartArea: true,
              },
            },
            {
              type: "linear",
              display: false,
              position: "right",
              id: "y-like4",
              ticks: {
                beginAtZero: true,
                max: 500,
                min: 0,
              },

              gridLines: {
                drawOnChartArea: true,
              },
            },
            {
              type: "linear",
              display: false,
              position: "right",
              id: "y-like5",
              ticks: {
                beginAtZero: true,
                max: 500,
                min: 0,
              },

              gridLines: {
                drawOnChartArea: true,
              },
            },
            {
              type: "linear",
              display: false,
              position: "right",
              id: "y-like6",
              ticks: {
                beginAtZero: true,
                max: 500,
                min: 0,
              },

              gridLines: {
                drawOnChartArea: true,
              },
            },
            {
              type: "linear",
              display: false,
              position: "right",
              id: "y-like7",
              ticks: {
                beginAtZero: true,
                max: 500,
                min: 0,
              },

              gridLines: {
                drawOnChartArea: true,
              },
            },
          ],
        },
      },
    });
  }
</script>
